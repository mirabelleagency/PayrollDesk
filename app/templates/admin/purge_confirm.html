{% extends "base.html" %}
{% block title %}Confirm Purge ¬∑ Payroll Desk{% endblock %}
{% block content %}
<section class="page-header" style="margin-bottom: 16px;">
  <div>
    <h1 class="page-title">üßπ Purge Model</h1>
    <p style="color:#94a3b8; margin:8px 0 0 0;">This will permanently remove the model and all related data. This action cannot be undone.</p>
  </div>
  <div class="header-actions">
    <a class="button secondary" href="/models">‚Üê Back to Models</a>
  </div>
</section>

<section class="card" style="margin-top: 8px;">
  <div class="section-heading">
    <div>
      <h2><span class="section-icon">‚ö†Ô∏è</span> Review Impact</h2>
      <p style="color:#94a3b8; margin:4px 0 0 0;">Model <strong>{{ impact.model_code }}</strong> (ID {{ impact.model_id }})</p>
    </div>
  </div>

  <div class="data-table-wrapper" style="margin-top: 12px;">
    <table class="data-table">
      <thead>
        <tr>
          <th>Category</th>
          <th style="text-align:right;">Count</th>
          <th style="text-align:right;">Amount</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Payouts (paid)</td>
          <td style="text-align:right;">{{ impact.payouts_paid }}</td>
          <td style="text-align:right;">{{ impact.payouts_paid_amount|money }}</td>
        </tr>
        <tr>
          <td>Payouts (unpaid)</td>
          <td style="text-align:right;">{{ impact.payouts_unpaid }}</td>
          <td style="text-align:right;">{{ impact.payouts_unpaid_amount|money }}</td>
        </tr>
        <tr>
          <td>Validation Issues</td>
          <td style="text-align:right;">{{ impact.validations }}</td>
          <td style="text-align:right;">‚Äî</td>
        </tr>
        <tr>
          <td>Adhoc Payments</td>
          <td style="text-align:right;">{{ impact.adhoc_payments }}</td>
          <td style="text-align:right;">{{ impact.adhoc_amount|money }}</td>
        </tr>
        <tr>
          <td>Compensation Adjustments</td>
          <td style="text-align:right;">{{ impact.adjustments }}</td>
          <td style="text-align:right;">‚Äî</td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <th>Total Rows to Delete (incl. model)</th>
          <th style="text-align:right;">{{ impact.total_rows }}</th>
          <th></th>
        </tr>
      </tfoot>
    </table>
  </div>

  <div style="margin-top: 16px; padding: 12px; background: rgba(239, 68, 68, 0.08); border: 1px solid rgba(239, 68, 68, 0.25); border-radius: 8px;">
    <p style="margin:0; color:#ef4444; font-weight:600;">This will also affect {{ impact.runs_affected }} schedule run{{ '' if impact.runs_affected == 1 else 's' }} that contain payouts for this model.</p>
  </div>

  <form method="post" action="/admin/models/{{ impact.model_id }}/purge" style="margin-top: 16px; display:flex; gap: 12px; align-items: center;">
    <a class="button secondary" href="/models">Cancel</a>
    <div style="display:flex; gap:8px; align-items:center;">
      <label for="confirm-code" style="color:#94a3b8; font-size:13px;">Type <strong>{{ impact.model_code }}</strong> to confirm</label>
      <input id="confirm-code" type="text" placeholder="Model code" style="padding:8px 10px; background: rgba(15,23,42,0.7); color:#f8fafc; border:1px solid rgba(148,163,184,0.3); border-radius:6px;" oninput="toggleDeleteButton()" autocomplete="off" />
    </div>
    <button id="confirm-delete" class="button button--primary" style="background:#ef4444; border-color: rgba(239,68,68,0.4);" type="submit" disabled>üßπ Permanently Delete</button>
  </form>
</section>
<script>
function toggleDeleteButton(){
  const input = document.getElementById('confirm-code');
  const btn = document.getElementById('confirm-delete');
  if(!input || !btn){ return; }
  btn.disabled = (input.value.trim() !== '{{ impact.model_code }}');
}
</script>
{% endblock %}

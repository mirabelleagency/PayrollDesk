{% extends "base.html" %}
{% block title %}Admin Settings Â· Payroll Desk{% endblock %}
{% block content %}
<section class="page-header" style="margin-bottom: 16px;">
  <div>
    <h1 class="page-title">âš™ï¸ Admin Settings</h1>
    <p style="color:#94a3b8; margin:8px 0 0 0;">Maintenance tools and data housekeeping</p>
  </div>
</section>

{% if message %}
<div class="alert success">{{ message }}</div>
{% endif %}
{% if error %}
<div class="alert" style="background: rgba(239, 68, 68, 0.12); border:1px solid rgba(239,68,68,0.35); color:#fecaca;">{{ error }}</div>
{% endif %}

<section class="card" style="margin-top: 8px;">
  <div class="section-heading">
    <div>
      <h2><span class="section-icon">ğŸ§¼</span> Maintenance</h2>
      <p style="color:#94a3b8; margin:4px 0 0 0;">Use with care â€“ actions apply immediately</p>
    </div>
  </div>
  <div style="display:flex; gap:12px; flex-wrap: wrap;">
    <form method="post" action="/admin/maintenance/cleanup-empty-runs">
      <button class="button button--primary" type="submit">ğŸ—‘ï¸ Delete Empty Schedule Runs</button>
    </form>
    <form method="post" action="/admin/maintenance/cleanup-orphans" onsubmit="return confirm('Remove legacy orphan records (model_id NULL) from payouts and validations? This cannot be undone.');">
      <button class="button secondary" type="submit" title="Delete payouts/validations that lost their model link">ğŸ§¹ Remove Legacy Orphan Records</button>
    </form>
    <form method="post" action="/admin/maintenance/reset-application-data" onsubmit="return confirm('This will delete ALL models, payouts, runs, validations, adjustments, adhoc payments, and advances. Users will be kept. This cannot be undone. Continue?');" style="display:flex; gap:8px; align-items:center;">
      <input type="text" name="confirm_text" id="confirm-text" placeholder="Type RESET to confirm" required
             style="padding:8px 10px; background: rgba(15,23,42,0.7); color:#f8fafc; border:1px solid rgba(148,163,184,0.3); border-radius:6px;" />
      <button id="reset-submit" class="button" type="submit" disabled style="background:#ef4444; border-color: rgba(239,68,68,0.4);">ğŸ§¨ Reset Database (Models + Payouts)</button>
    </form>
  </div>
</section>

<script>
  (function(){
    const input = document.getElementById('confirm-text');
    const btn = document.getElementById('reset-submit');
    function toggle(){
      if(!input || !btn) return;
      btn.disabled = (input.value.trim().toUpperCase() !== 'RESET');
    }
    if(input){
      input.addEventListener('input', toggle);
      toggle();
    }
  })();
</script>

<section class="card" style="margin-top: 16px;">
  <div class="section-heading">
    <div>
      <h2><span class="section-icon">ğŸ§°</span> Tools</h2>
      <p style="color:#94a3b8; margin:4px 0 0 0;">Model purge is available from each model view or via the purge link with ID</p>
    </div>
  </div>
  <div>
    <p>JSON API endpoints:</p>
    <ul>
      <li>GET /admin/api/models/{model_id}/purge?dry_run=true</li>
      <li>POST /admin/api/models/{model_id}/purge</li>
    </ul>
  </div>
</section>

{% endblock %}
